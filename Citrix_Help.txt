param(
    [Parameter(Mandatory=$true)]
    [string]$ComputerName
)

Write-Host "Collecting applied Group Policies from $ComputerName..." -ForegroundColor Cyan

# Test connectivity first
if (-not (Test-Connection -ComputerName $ComputerName -Count 1 -Quiet)) {
    Write-Error "Unable to reach $ComputerName."
    exit
}

try {
    # Query applied COMPUTER policies
    $computerGpos = Invoke-Command -ComputerName $ComputerName -ScriptBlock {
        gpresult /SCOPE COMPUTER /V | Select-String "Applied Group Policy Objects"
    }

    # Query applied USER policies (for SYSTEM user context this may be empty)
    $userGpos = Invoke-Command -ComputerName $ComputerName -ScriptBlock {
        gpresult /SCOPE USER /V | Select-String "Applied Group Policy Objects"
    }

    Write-Host "`n=== COMPUTER APPLIED GPOs ===" -ForegroundColor Yellow
    $computerGpos -replace "Applied Group Policy Objects", "" | ForEach-Object {
        $_.ToString().Trim()
    }

    Write-Host "`n=== USER APPLIED GPOs ===" -ForegroundColor Yellow
    if ($userGpos) {
        $userGpos -replace "Applied Group Policy Objects", "" | ForEach-Object {
            $_.ToString().Trim()
        }
    } else {
        Write-Host "(No user policies returned â€” service account or no interactive user.)"
    }

} catch {
    Write-Error $_.Exception.Message
}
